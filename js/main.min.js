"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})});const api={apikey:"5290defddab27e09fb2b75fd44ba25f4",cUrl:"https://api.openweathermap.org/data/2.5/weather?",dUrl:"https://api.openweathermap.org/data/2.5/onecall?",iconUrl:"https://openweathermap.org/img/wn/"},weatherByName=e=>`${api.cUrl}q=${e}&APPID=${api.apikey}&units=metric`,weatherByCoord=(e,t)=>[`${api.cUrl}lat=${e}&lon=${t}&APPID=${api.apikey}&units=metric`,`${api.dUrl}lat=${e}&lon=${t}&appid=${api.apikey}&units=metric&cnt=8`];window.onload=function(){init()};const init=()=>{const e=localStorage.getItem("weatherData")?JSON.parse(localStorage.getItem("weatherData")):{},t=localStorage.getItem("dailyWeather")?JSON.parse(localStorage.getItem("dailyWeather")):{};e!=={}&&getCurrentData(e),t!=={}&&getDailyData(t)},getCurrentWeather=(e,t)=>{fetch(e).then(e=>{200==e.status&&e.json().then(e=>{localStorage.setItem("weatherData",JSON.stringify(e)),getCurrentData(e,t)}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})},getDailyWeather=(e,t)=>{fetch(e).then(e=>{200==e.status&&e.json().then(e=>{localStorage.setItem("dailyWeather",JSON.stringify(e)),getDailyData(e,t)}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})},getCurrentData=(e,t)=>{let[a]=dateBuilder(e.dt);const n=-1==e.weather[0].description.indexOf("rain")?'<div class="safe">Safe to go out</div>':'<div class="not-safe">Its Not safe</div>',r=`\n    <section class="location">\n        <div class="city">${e.name}, ${e.sys.country}</div>\n        <div class="date">${a}</div>\n    </section>\n    <div class="current">\n        <div class="temp">${Math.round(e.main.temp)}<span>°c<img alt="weather icon" class="icon" src="${api.iconUrl}${e.weather[0].icon}@2x.png"></span></div>\n        <div class="weather">${e.weather[0].description}</div>\n        <div class="hi-low">${Math.round(e.main.temp_min)}°c/${Math.round(e.main.temp_max)}°c</div>\n        ${n}\n    </div>`;document.querySelector("#main").innerHTML=r},getDailyData=(e,t)=>{let a='\n    <h3 id="dtitle">Daily Weather for the Week</h3>\n    <table border="0">\n    <thead>\n        <th class="align-left">Day</th>\n        <th>Weather</th>\n        <th>Description</th>\n        <th>Temp</th>\n        <th>Humidity</th>\n        <th>Wind</th>\n    </thead>\n    <tbody>';for(let t=1;t<e.daily.length;t++){let[n,r]=dateBuilder(e.daily[t].sunrise);a+=`<tr>\n        <th class="align-left">${r}<br><small>${n.substring(n.indexOf(",")+1,n.lastIndexOf(","),1)}</small></th>\n        <td class="icon"><small><img  alt="weather icon" class="iconImg" src="${api.iconUrl}${e.daily[t].weather[0].icon}.png"></small></td>\n        <td><small>${e.daily[t].weather[0].description}</small></td>\n        <td>${Math.round(e.daily[t].temp.min)}°c / ${Math.round(e.daily[t].temp.max)}°c</td>\n        <td>${e.daily[t].humidity}%</td>\n        <td>${e.daily[t].wind_speed}km/hr</td>\n        </tr>`}a+="</tbody>\n              </table> <br/><br/><br/>",document.querySelector("#dailyWeather").innerHTML=a},searchQuery=e=>{let t,a,n;const r=weatherByName(e);getCurrentWeather(r),fetch(r).then(e=>{200==e.status?e.json().then(e=>{n=e.name,t=e.coord.lon,a=e.coord.lat;let[,r]=weatherByCoord(a,t);getDailyWeather(r)}).catch(e=>{console.log(e)}):alert("sorry, location not found. Check the spelling and try again!")}).catch(e=>{console.log(e)})},search=document.querySelector("#searchTerm");search.addEventListener("keypress",function(e){const t=search.value;t&&"Enter"===e.key&&(e.preventDefault(),searchQuery(t.trim()))});const submit=document.querySelector("#submit");submit.addEventListener("click",function(e){const t=document.querySelector("#searchTerm").value;e.preventDefault(),t?searchQuery(t.trim()):alert("Please enter a country, city or town")});const dateBuilder=e=>{let t=1e3*e;const a=new Date(t).toLocaleString();let n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(t).getDay()];return[`${n}, ${a}`,n]};